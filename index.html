<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Sins of the Past ‚Äî Intro</title>
<link rel="preload" as="image" href="assets/SinsF.png"><!-- Preload first logo -->
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<style>
html,body{margin:0;height:100%;background:#000;color:#fff;font-family:'Press Start 2P',monospace;overflow:hidden;display:flex;align-items:center;justify-content:center;flex-direction:column}

/* retro grid */
#grid{position:absolute;inset:0;background:
  linear-gradient(#111 1px,transparent 1px),
  linear-gradient(90deg,#111 1px,transparent 1px);
background-size:40px 40px;opacity:.35;transform:perspective(900px) rotateX(60deg)}

/* Crossfading logo stack */
#logoWrap{position:relative; width:min(420px,70vw); aspect-ratio:2.6/1; margin:0 16px 18px; z-index:1}
.logoLayer{
  position:absolute; inset:0; width:100%; height:100%; object-fit:contain;
  transition:opacity .7s ease; opacity:0; pointer-events:none;
  image-rendering:auto;
}
.logoLayer.visible{ opacity:1; }

/* neon glow */
#logoWrap .logoLayer{ animation:glow 2s ease-in-out infinite alternate; }
@keyframes glow{from{text-shadow:0 0 8px #ff5a5a,0 0 16px #00e0c6}to{text-shadow:0 0 20px #ff5a5a,0 0 40px #00e0c6}}

#press{font-size:14px;letter-spacing:2px;margin-top:16px;display:none;z-index:1;animation:blink 1s steps(2,start) infinite;cursor:pointer}
@keyframes blink{to{visibility:hidden}}
.fade{animation:fadeout .8s forwards}
@keyframes fadeout{to{opacity:0;visibility:hidden}}

/* cards */
.card{z-index:2;width:min(480px,92vw);background:rgba(14,14,20,.9);border:2px solid #00e0c6;border-radius:12px;padding:16px}
.card p{font-size:11px;line-height:1.6;margin:0 0 8px}

/* üî• form usability */
.card label{display:block;margin-top:10px;font-size:11px;cursor:pointer}
.card input[type=text],
.card input[type=email]{display:block;width:100%;box-sizing:border-box;margin-top:4px;padding:8px;border-radius:8px;border:1px solid #444;background:#0b0c13;color:#fff;font-family:inherit;font-size:12px}
.card input:focus-visible{outline:2px solid #00e0c6;outline-offset:2px}
.error{color:#ff8080;font-size:10px;margin-top:6px;display:none}
.msg{display:none;font-size:10px;color:#aaa;margin-top:6px}

/* buttons */
.btns{display:flex;gap:8px;margin-top:12px;flex-wrap:wrap}
.btn{padding:8px 12px;border-radius:8px;border:1px solid #444;background:#0b0c13;color:#fff;cursor:pointer}
.btn.primary{border-color:transparent;background:#ff5a5a;color:#111;font-weight:bold}

/* mini-game hud */
.score{display:flex;justify-content:space-between;align-items:center;border:1px solid #333;border-radius:10px;padding:10px 12px;margin:8px 0 12px}
.score b{font-size:12px}
.badge{display:inline-block;padding:4px 8px;border-radius:8px;border:1px solid #444;font-size:10px}

/* footer bits */
.util{position:fixed;bottom:10px;left:10px;z-index:3;font-size:10px;opacity:.8}
.util a{color:#9cf;text-decoration:underline;cursor:pointer}
.footer-hint{position:fixed;bottom:10px;right:10px;z-index:3;font-size:10px;opacity:.6}

/* cover-page cursor */
:root{ --cursor: url('assets/indexgrim.png') 12 12, auto; }
:where(html, body, *):not(input, textarea, [contenteditable="true"]) { cursor: var(--cursor) !important; }
input, textarea, [contenteditable="true"] { cursor: text !important; }
.cursor { pointer-events:none; }

/* focus rings everywhere */
:focus-visible{outline:2px solid #00e0c6; outline-offset:2px}

/* little stack for Press actions */
#pressActions{display:none; margin-top:8px; z-index:2; text-align:center}
#pressActions .who{opacity:.8; font-size:12px; display:block; margin-bottom:6px}

/* Respect reduced motion */
@media (prefers-reduced-motion: reduce) {
  .logoLayer { transition:none; animation:none; }
  #press { animation:none; }
  .fade { animation:none; }
}
</style>
</head>
<body>
<div id="grid" aria-hidden="true"></div>

<!-- Crossfading Rotating Logo -->
<div id="logoWrap" aria-hidden="true">
  <img id="logoA" class="logoLayer visible" src="assets/SinsF.png" alt="">
  <img id="logoB" class="logoLayer" src="" alt="">
</div>

<!-- Create Account -->
<div id="acctCard" class="card" role="dialog" aria-labelledby="acctLabel" aria-modal="true" style="display:none">
  <p id="acctLabel"><b>Create your account</b> to enter Sins of the Past.</p>

  <label for="acctName">Display name</label>
  <input id="acctName" type="text" placeholder="ex: Muva, Unca" autocomplete="name">

  <label for="acctEmail">Email</label>
  <input id="acctEmail" type="email" placeholder="you@example.com" autocomplete="email" inputmode="email">
  <div id="acctErr" class="error" role="alert"></div>

  <div class="btns">
    <button id="acctCreateBtn" class="btn primary">Create account</button>
    <button id="acctSkipBtn" class="btn" title="Skip account on this device">Skip</button>
  </div>
  <div id="acctMsg" class="msg" aria-live="polite"></div>
</div>

<!-- Sin question -->
<div id="sinCard" class="card" role="dialog" aria-labelledby="sinLabel" aria-modal="true" style="display:none">
  <p id="sinLabel">Before you enter‚Ä¶ tell us your <b>last sin</b></p>
  <label for="sinInput">Type your answer:</label>
  <input id="sinInput" type="text" placeholder="ex: pride, greed, or your own‚Ä¶" autocomplete="off" autocapitalize="none" aria-describedby="sinHelp">
  <div id="sinHelp" class="msg" style="display:block;opacity:.7">Tip: you can skip, but then you must beat the Reaper.</div>
  <div id="sinErr" class="error" role="alert"></div>
  <div class="btns">
    <button id="saveBtn" class="btn primary">Save</button>
    <button id="skipBtn" class="btn">Skip</button>
  </div>
  <div id="msg" class="msg" aria-live="polite"></div>
</div>

<!-- Mini-game -->
<div id="rpsGame" class="card" style="display:none;margin-top:20px">
  <div class="score">
    <div><b>Best 2 of 3</b> <span id="round" class="badge">Round 1</span></div>
    <div><span class="badge">You: <b id="pScore">0</b></span> <span class="badge">Reaper: <b id="rScore">0</b></span></div>
  </div>
  <p>Refuse to confess? Face the Reaper in <b>Rock ¬∑ Paper ¬∑ Scythe</b>!</p>
  <div style="display:flex;gap:8px;margin-top:12px;flex-wrap:wrap">
    <button class="btn choice" data-move="rock">ü™® Rock</button>
    <button class="btn choice" data-move="paper">üìú Paper</button>
    <button class="btn choice" data-move="scythe">‚öîÔ∏è Scythe</button>
  </div>
  <div id="rpsResult" class="msg" style="margin-top:10px" role="status" aria-live="polite"></div>
</div>

<!-- Press start -->
<div id="press" role="button" tabindex="0" aria-label="Press start to enter" aria-describedby="pressHint">PRESS START</div>
<div id="pressActions">
  <span id="pressWho" class="who"></span>
  <button id="continueBtn" class="btn primary" type="button" style="display:none">Continue</button>
  <div><a id="switchLink" href="#" style="display:none">switch</a></div>
</div>
<div id="pressHint" class="footer-hint">Click or press any key to enter.</div>

<div class="util">
  <span id="signedInAs" style="display:none">Signed in as <b id="who"></b></span>
  ¬∑ <a id="resetLink">reset intro</a>
</div>

<script>
/* ================== Config ================== */
const ROTATE_MS = 3500;
const REQUIRE_SIN = true;         // require a sin to proceed to PRESS
const AUTO_ENTER_MS = 1500;       // auto-enter after PRESS shows

/* Reduced motion (no auto-enter if user prefers reduced motion) */
let REDUCED_MOTION = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
try {
  window.matchMedia('(prefers-reduced-motion: reduce)').addEventListener('change', e => {
    REDUCED_MOTION = e.matches;
    if (REDUCED_MOTION) cancelAutoEnter();
  });
} catch(_) { /* older browsers */ }

/* ================== Rotating Logo (crossfade + gif support) ================== */
const logoImages = [
  "assets/SinsF.png",
  "assets/SinsFF.png"
  // add more, incl. GIFs if you want
];
const logoA = document.getElementById('logoA');
const logoB = document.getElementById('logoB');
let currentLayer = 'A';
let logoIndex = 0;
let rotateTimer = null;

function cacheBust(url){ const hasQ = url.includes('?'); return url + (hasQ ? '&' : '?') + 'cb=' + Date.now(); }
function preload(url){ return new Promise((res,rej)=>{ const img=new Image(); img.onload=()=>res(url); img.onerror=()=>rej(url); img.src=cacheBust(url); }); }
function setLayerSrc(layer, url){ (layer==='A'?logoA:logoB).src = cacheBust(url); }
function crossfadeTo(url){
  const front = (currentLayer==='A'?logoA:logoB);
  const back  = (currentLayer==='A'?logoB:logoA);
  back.src = cacheBust(url);
  back.classList.add('visible');
  front.classList.remove('visible');
  currentLayer = (currentLayer==='A'?'B':'A');
}
async function rotateNext(){
  const next = (logoIndex + 1) % logoImages.length;
  try{ const ok = await preload(logoImages[next]); crossfadeTo(ok); logoIndex = next; }
  catch(bad){ console.warn('Skip missing logo:', bad); logoIndex = next; }
}
function startLogoRotation(){
  if (logoImages.length>0) setLayerSrc(currentLayer, logoImages[0]);
  rotateTimer = setInterval(rotateNext, ROTATE_MS);
}

/* ================== Account + Sin + Flow ================== */
const ACCT_KEY='stp_user'; // {id,name,email,createdAt}
const SIN_KEY='stp_sin';

const acctCard=document.getElementById('acctCard');
const acctName=document.getElementById('acctName');
const acctEmail=document.getElementById('acctEmail');
const acctCreateBtn=document.getElementById('acctCreateBtn');
const acctSkipBtn=document.getElementById('acctSkipBtn');
const acctMsg=document.getElementById('acctMsg');
const acctErr=document.getElementById('acctErr');

const sinCard=document.getElementById('sinCard');
const sinInput=document.getElementById('sinInput');
const sinErr=document.getElementById('sinErr');

const game=document.getElementById('rpsGame');
const press=document.getElementById('press');
const pressActions=document.getElementById('pressActions');
const continueBtn=document.getElementById('continueBtn');
const pressWho=document.getElementById('pressWho');
const signedInAs=document.getElementById('signedInAs');
const whoEl=document.getElementById('who');
const switchLink=document.getElementById('switchLink');

function show(el){ el.style.display='block'; }
function hide(el){ el.style.display='none'; }

function showAcct(){ show(acctCard); hide(sinCard); hide(game); hide(press); hide(pressActions); acctName.focus(); }
function showSin(){ hide(acctCard); show(sinCard); hide(game); hide(press); hide(pressActions); sinInput.focus(); }
function showGame(){ hide(acctCard); hide(sinCard); show(game); hide(press); hide(pressActions); }
let autoEnterT=null;
function cancelAutoEnter(){ if (autoEnterT){ clearTimeout(autoEnterT); autoEnterT=null; } }
function showPress(){
  hide(acctCard); hide(sinCard); hide(game); show(press); show(pressActions);
  const acct = loadAcct();
  if (acct){
    pressWho.textContent = `Signed in as ${acct.name || acct.email}`;
    switchLink.style.display = 'inline';
    continueBtn.style.display = 'inline-block';
  } else {
    pressWho.textContent = '';
    switchLink.style.display = 'none';
    continueBtn.style.display = 'none';
  }
  cancelAutoEnter();
  if (!REDUCED_MOTION) autoEnterT = setTimeout(()=> enter(), AUTO_ENTER_MS);
}

/* storage */
function loadAcct(){ try{ return JSON.parse(localStorage.getItem(ACCT_KEY) || 'null'); }catch(e){ return null; } }
function saveAcct(obj){ localStorage.setItem(ACCT_KEY, JSON.stringify(obj)); whoEl.textContent=obj.name||obj.email||'Guest'; signedInAs.style.display='inline'; }
function clearAcct(){ localStorage.removeItem(ACCT_KEY); signedInAs.style.display='none'; whoEl.textContent=''; }

/* init route */
(function init(){
  logoA.classList.add('visible'); logoB.classList.remove('visible');
  startLogoRotation();

  const acct=loadAcct();
  if (!acct){
    showAcct();
  } else {
    whoEl.textContent=acct.name||acct.email||'Guest'; signedInAs.style.display='inline';
    const savedSin = localStorage.getItem(SIN_KEY);
    if (REQUIRE_SIN){
      if (savedSin && savedSin !== 'none') showPress(); else showSin();
    } else {
      showPress();
    }
  }
})();

/* email validation */
function emailValid(v){ return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v); }

/* create/skip account */
acctCreateBtn.onclick=()=>{
  acctErr.style.display='none';
  const name=(acctName.value||'').trim();
  const email=(acctEmail.value||'').trim();
  if(!name || !email){ acctErr.textContent = "Please enter both a display name and an email."; acctErr.style.display='block'; return; }
  if(!emailValid(email)){ acctErr.textContent = "That email doesn't look valid. Try again."; acctErr.style.display='block'; return; }
  const acctObj = { id:'stp_'+Math.random().toString(36).slice(2), name, email, createdAt:new Date().toISOString() };
  saveAcct(acctObj);
  acctMsg.textContent = "Account created.";
  acctMsg.style.display = 'block';
  setTimeout(()=> showSin(), 500);
};
acctSkipBtn.onclick=()=>{ clearAcct(); REQUIRE_SIN ? showSin() : showPress(); };

/* switch account from press screen */
switchLink.onclick=(e)=>{ e.preventDefault(); clearAcct(); localStorage.removeItem(SIN_KEY); showAcct(); cancelAutoEnter(); };

/* save/skip sin */
document.getElementById('saveBtn').onclick=()=>{
  sinErr.style.display='none';
  const val=sinInput.value.trim();
  if(!val){ sinErr.textContent="Please type something (or skip)."; sinErr.style.display='block'; return; }
  localStorage.setItem(SIN_KEY,val);
  document.getElementById('msg').textContent="Saved: "+val;
  document.getElementById('msg').style.display='block';
  setTimeout(()=> showPress(), 700);
};
document.getElementById('skipBtn').onclick=()=>{
  localStorage.setItem(SIN_KEY,'none');
  REQUIRE_SIN ? (resetMatch(), showGame()) : showPress();
};

/* ================== Mini-game ================== */
let rpsResolved=false,pWins=0,rWins=0,round=1;
const pScoreEl=document.getElementById('pScore');
const rScoreEl=document.getElementById('rScore');
const roundEl=document.getElementById('round');
const resultEl=document.getElementById('rpsResult');

function updateHUD(){ if(!pScoreEl)return; pScoreEl.textContent=String(pWins); rScoreEl.textContent=String(rWins); roundEl.textContent=`Round ${round}`; }
function resetMatch(){ pWins=0;rWins=0;round=1;rpsResolved=false; if(pScoreEl){ pScoreEl.textContent='0'; rScoreEl.textContent='0'; roundEl.textContent='Round 1'; resultEl.textContent=''; resultEl.style.display='none'; } }
const moves=["rock","paper","scythe"];
function resultFor(p,c){ if(p===c)return"draw"; if(p==="rock"&&c==="scythe")return"win"; if(p==="scythe"&&c==="paper")return"win"; if(p==="paper"&&c==="rock")return"win"; return"lose"; }
function resolveRound(player){
  const comp=moves[Math.floor(Math.random()*moves.length)],res=resultFor(player,comp);
  resultEl.style.display="block";
  if(res==="draw"){resultEl.innerHTML=`You chose <b>${player}</b>, Reaper chose <b>${comp}</b> ‚Äî <b>Draw</b>. Play again.`;return;}
  if(res==="win"){pWins++;}else{rWins++;}
  resultEl.innerHTML=`You chose <b>${player}</b>, Reaper chose <b>${comp}</b> ‚Äî `+(res==="win"?"<b>You win the round.</b>":"<b>Reaper wins the round.</b>");
  if (pWins===2 || rWins===2){
    rpsResolved = true;
    const who=(pWins===2)?"üî• You win ‚Äî the Reaper grants you passage!":"üíÄ The Reaper claims victory.";
    resultEl.innerHTML += `<br>${who}`;
    setTimeout(()=>enter(), 1100);
    return;
  }
  round++; updateHUD();
}
document.querySelectorAll('.choice').forEach(btn=> btn.onclick=()=> resolveRound(btn.dataset.move));
updateHUD();

/* ================== Enter logic ================== */
function enter(){
  if (acctCard.style.display!=='none') return;            // still on account screen
  if (REQUIRE_SIN){
    const sin = localStorage.getItem('stp_sin');
    if (sinCard.style.display!=='none') return;           // still on sin screen
    if (sin === 'none' && game.style.display!=='none' && !rpsResolved) return; // must beat game
  }
  sessionStorage.setItem('stp_from_cover','1');
  document.body.classList.add('fade');
  setTimeout(()=>window.location.replace('./home.html'),700);
}
continueBtn.addEventListener('click', enter);

/* ================== Seamless PRESS START Entry (guarded) ================== */
function isTypingTarget(el){ return el && (el.tagName==='INPUT' || el.tagName==='TEXTAREA' || el.isContentEditable); }
function isInteractive(el){
  if (!el) return false;
  const tag=el.tagName;
  return ['INPUT','TEXTAREA','BUTTON','A','SELECT','LABEL'].includes(tag) || el.isContentEditable;
}
['mousemove','keydown','touchstart','click'].forEach(evt=>{
  document.addEventListener(evt, ()=> cancelAutoEnter(), {passive:true});
});
['click','touchstart'].forEach(evt=>{
  document.addEventListener(evt,(e)=>{
    if (isInteractive(e.target)) return;
    if (press.style.display!=='none') enter();
  },{passive:true});
});
document.addEventListener('keydown',(e)=>{
  if (isTypingTarget(e.target)) return;
  const ignore=['Shift','Alt','Control','Meta','CapsLock','Tab'];
  if (ignore.includes(e.key)) return;
  if (press.style.display!=='none') enter();
});
press.addEventListener('click',()=> enter());
press.addEventListener('keydown',(e)=>{ if(e.key==='Enter'||e.key===' ') enter(); });

/* ================== Reset intro ================== */
document.getElementById('resetLink').onclick=(e)=>{
  e.preventDefault();
  localStorage.removeItem(SIN_KEY);
  resetMatch();
  const acct = loadAcct();
  acct ? showSin() : showAcct();
};
</script>

<!-- Optional: only if you have global JS -->
<script src="app.js"></script>
<div class="cursor"></div>
<script>
  const cursor=document.querySelector('.cursor');
  document.addEventListener('mousemove',e=>{ cursor.style.left=e.clientX+'px'; cursor.style.top=e.clientY+'px'; });
</script>
</body>
</html>
